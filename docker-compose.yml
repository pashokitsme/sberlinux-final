services:
  vpn-server:
    build:
      context: .
      dockerfile: vpn-server/Dockerfile
    image: vpn-server:latest
    volumes:
      - ./config/server.yml:/etc/vpn/config.yml
    networks:
      vpn_net:
        ipv4_address: 10.0.0.20

  vpn-client:
    build:
      context: .
      dockerfile: vpn-client/Dockerfile
    image: vpn-client:latest
    privileged: true
    cap_add:
      - NET_ADMIN
      - NET_RAW
    devices:
      - /dev/net/tun:/dev/net/tun
    volumes:
      - ./config/client.yml:/etc/vpn/config.yml
    networks:
      vpn_net:
        ipv4_address: 10.0.0.10
    depends_on:
      - vpn-server

networks:
  vpn_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.0.0.0/16
